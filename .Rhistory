by = c('categoria')) %>%
left_join(percent_evasores_est_regiao %>% filter(Estrutura == 'LOJAS') %>% select(LocalizacaoGeografica, proporcao),
by = c('LocalizacaoGeografica')) %>%
mutate(prop_ref = prop_motivo_est * proporcao,
prop_motivo_regiao = qtde_processos / n_proc_lojas_brasil,
delta_ref = prop_motivo_regiao - prop_ref,
std_error = sqrt(prop_motivo_regiao * (1 - prop_motivo_regiao) / n),
up_conf_inter95 = prop_motivo_regiao + qnorm(.975) * std_error,
low_conf_inter95 = prop_motivo_regiao - qnorm(.975) * std_error,
low_conf_inter95 = ifelse(low_conf_inter95 < 0, 0, low_conf_inter95)) %>%
complete(LocalizacaoGeografica, categoria, fill = list(delta_ref = 0)) %>%
arrange(delta_ref)
ggplot(prop_motivos_lojas) +
aes(x = prop_motivo_regiao, y = LocalizacaoGeografica) +
geom_col(fill = 'gray80') +
geom_errorbar(aes(xmin = low_conf_inter95, xmax = up_conf_inter95),
width = 0.2,
color = '#4d4d4d') +
facet_wrap(~categoria, scales = 'free_x') +
scale_x_continuous(expand = expansion(mult = c(0, 0.1))) +
theme(panel.background = element_rect(fill = NA, color = 'gray70'),
axis.ticks.y = element_blank())
ggplot(prop_motivos_lojas %>%  filter(!is.na(LocalizacaoGeografica))) +
aes(y = fct_reorder(categoria, delta_ref, .fun = max),
x = fct_reorder(LocalizacaoGeografica, -delta_ref, min),
fill = delta_ref) +
geom_tile(color = 'gray80') +
geom_text(aes(label = paste0(sprintf("%+3.1f", 100 * delta_ref), 'pp')), color = 'gray20') +
scale_fill_gradient2(low = '#4d4d4d', high = '#5288db') +
scale_x_discrete(position = 'top') +
coord_equal() +
labs(x = '', y = '') +
guides(fill = 'none') +
theme(panel.background = element_blank(),
axis.ticks = element_blank())
View(proc_abertos_depara)
proc_abertos_depara %>%
filter(Estrutura == 'LOJAS') %>%
group_by(LocalizacaoGeografica, categoria) %>%
summarise(qtde_processos = n()) %>%
ungroup() %>%
left_join(count_regiao, by = c('LocalizacaoGeografica')) %>%
left_join(prop_motivos %>% filter(Estrutura == 'LOJAS') %>% select(categoria, prop_motivo_est),
by = c('categoria')) %>%
left_join(percent_evasores_est_regiao %>% filter(Estrutura == 'LOJAS') %>% select(LocalizacaoGeografica, proporcao),
by = c('LocalizacaoGeografica')) %>%
mutate(prop_ref = prop_motivo_est * proporcao,
prop_motivo_regiao = qtde_processos / n_proc_lojas_brasil,
delta_ref = prop_motivo_regiao - prop_ref,
std_error = sqrt(prop_motivo_regiao * (1 - prop_motivo_regiao) / n),
up_conf_inter95 = prop_motivo_regiao + qnorm(.975) * std_error,
low_conf_inter95 = prop_motivo_regiao - qnorm(.975) * std_error,
low_conf_inter95 = ifelse(low_conf_inter95 < 0, 0, low_conf_inter95))
proc_abertos_depara %>%
filter(Estrutura == 'LOJAS') %>%
group_by(LocalizacaoGeografica, categoria) %>%
summarise(qtde_processos = n()) %>%
ungroup() %>%
left_join(count_regiao, by = c('LocalizacaoGeografica')) %>%
left_join(prop_motivos %>% filter(Estrutura == 'LOJAS') %>% select(categoria, prop_motivo_est),
by = c('categoria')) %>%
left_join(percent_evasores_est_regiao %>% filter(Estrutura == 'LOJAS') %>% select(LocalizacaoGeografica, proporcao),
by = c('LocalizacaoGeografica'))
View(count_estrutura)
proc_abertos_depara %>%
filter(Estrutura == 'LOJAS') %>%
group_by(LocalizacaoGeografica, categoria) %>%
summarise(qtde_processos = n()) %>%
ungroup() %>%
left_join(count_regiao, by = c('LocalizacaoGeografica')) %>%
left_join(prop_motivos %>% filter(Estrutura == 'LOJAS') %>% select(categoria, prop_motivo_est),
by = c('categoria')) %>%
left_join(percent_evasores_est_regiao %>% filter(Estrutura == 'LOJAS') %>% select(LocalizacaoGeografica, proporcao),
by = c('LocalizacaoGeografica'))
prop_motivos_lojas <- proc_abertos_depara %>%
filter(Estrutura == 'LOJAS') %>%
group_by(LocalizacaoGeografica, categoria) %>%
summarise(qtde_processos = n()) %>%
ungroup() %>%
left_join(count_regiao, by = c('LocalizacaoGeografica')) %>%
left_join(prop_motivos %>% filter(Estrutura == 'LOJAS') %>% select(categoria, prop_motivo_est),
by = c('categoria')) %>%
left_join(percent_evasores_est_regiao %>% filter(Estrutura == 'LOJAS') %>% select(LocalizacaoGeografica, proporcao),
by = c('LocalizacaoGeografica')) %>%
mutate(prop_ref = prop_motivo_est * proporcao,
prop_motivo_regiao = qtde_processos / n,
delta_ref = prop_motivo_regiao - prop_ref,
std_error = sqrt(prop_motivo_regiao * (1 - prop_motivo_regiao) / n),
up_conf_inter95 = prop_motivo_regiao + qnorm(.975) * std_error,
low_conf_inter95 = prop_motivo_regiao - qnorm(.975) * std_error,
low_conf_inter95 = ifelse(low_conf_inter95 < 0, 0, low_conf_inter95)) %>%
complete(LocalizacaoGeografica, categoria, fill = list(delta_ref = 0)) %>%
arrange(delta_ref)
ggplot(prop_motivos_lojas) +
aes(x = prop_motivo_regiao, y = LocalizacaoGeografica) +
geom_col(fill = 'gray80') +
geom_errorbar(aes(xmin = low_conf_inter95, xmax = up_conf_inter95),
width = 0.2,
color = '#4d4d4d') +
facet_wrap(~categoria, scales = 'free_x') +
scale_x_continuous(expand = expansion(mult = c(0, 0.1))) +
theme(panel.background = element_rect(fill = NA, color = 'gray70'),
axis.ticks.y = element_blank())
ggplot(prop_motivos_lojas %>%  filter(!is.na(LocalizacaoGeografica))) +
aes(y = fct_reorder(categoria, delta_ref, .fun = max),
x = fct_reorder(LocalizacaoGeografica, -delta_ref, min),
fill = delta_ref) +
geom_tile(color = 'gray80') +
geom_text(aes(label = paste0(sprintf("%+3.1f", 100 * delta_ref), 'pp')), color = 'gray20') +
scale_fill_gradient2(low = '#4d4d4d', high = '#5288db') +
scale_x_discrete(position = 'top') +
coord_equal() +
labs(x = '', y = '') +
guides(fill = 'none') +
theme(panel.background = element_blank(),
axis.ticks = element_blank())
prop_motivos_lojas <- proc_abertos_depara %>%
filter(Estrutura == 'LOJAS') %>%
group_by(LocalizacaoGeografica, categoria) %>%
summarise(qtde_processos = n()) %>%
ungroup() %>%
left_join(count_regiao, by = c('LocalizacaoGeografica')) %>%
left_join(prop_motivos %>% filter(Estrutura == 'LOJAS') %>% select(categoria, prop_motivo_est),
by = c('categoria')) %>%
left_join(percent_evasores_est_regiao %>% filter(Estrutura == 'LOJAS') %>% select(LocalizacaoGeografica, proporcao),
by = c('LocalizacaoGeografica')) %>%
mutate(prop_ref = prop_motivo_est * proporcao,
prop_motivo_regiao = qtde_processos / n,
prop_motivo_brasil = qtde_processos / n_proc_lojas_brasil,
delta_ref = prop_motivo_regiao - prop_ref,
std_error = sqrt(prop_motivo_regiao * (1 - prop_motivo_regiao) / n),
up_conf_inter95 = prop_motivo_regiao + qnorm(.975) * std_error,
low_conf_inter95 = prop_motivo_regiao - qnorm(.975) * std_error,
low_conf_inter95 = ifelse(low_conf_inter95 < 0, 0, low_conf_inter95)) %>%
complete(LocalizacaoGeografica, categoria, fill = list(delta_ref = 0)) %>%
arrange(delta_ref)
ggplot(prop_motivos_lojas) +
aes(x = prop_motivo_regiao, y = LocalizacaoGeografica) +
geom_col(fill = 'gray80') +
geom_errorbar(aes(xmin = low_conf_inter95, xmax = up_conf_inter95),
width = 0.2,
color = '#4d4d4d') +
facet_wrap(~categoria, scales = 'free_x') +
scale_x_continuous(expand = expansion(mult = c(0, 0.1))) +
theme(panel.background = element_rect(fill = NA, color = 'gray70'),
axis.ticks.y = element_blank())
ggplot(prop_motivos_lojas) +
aes(x = prop_motivo_brasil, y = LocalizacaoGeografica) +
geom_col(fill = 'gray80') +
geom_errorbar(aes(xmin = low_conf_inter95, xmax = up_conf_inter95),
width = 0.2,
color = '#4d4d4d') +
facet_wrap(~categoria, scales = 'free_x') +
scale_x_continuous(expand = expansion(mult = c(0, 0.1))) +
theme(panel.background = element_rect(fill = NA, color = 'gray70'),
axis.ticks.y = element_blank())
ggplot(prop_motivos_lojas) +
aes(x = prop_motivo_regiao, y = LocalizacaoGeografica) +
geom_col(fill = 'gray80') +
geom_errorbar(aes(xmin = low_conf_inter95, xmax = up_conf_inter95),
width = 0.2,
color = '#4d4d4d') +
facet_wrap(~categoria, scales = 'free_x') +
scale_x_continuous(expand = expansion(mult = c(0, 0.1))) +
theme(panel.background = element_rect(fill = NA, color = 'gray70'),
axis.ticks.y = element_blank())
ggplot(prop_motivos_lojas %>%  filter(!is.na(LocalizacaoGeografica))) +
aes(y = fct_reorder(categoria, delta_ref, .fun = max),
x = fct_reorder(LocalizacaoGeografica, -delta_ref, min),
fill = delta_ref) +
geom_tile(color = 'gray80') +
geom_text(aes(label = paste0(sprintf("%+3.1f", 100 * delta_ref), 'pp')), color = 'gray20') +
scale_fill_gradient2(low = '#4d4d4d', high = '#5288db') +
scale_x_discrete(position = 'top') +
coord_equal() +
labs(x = '', y = '') +
guides(fill = 'none') +
theme(panel.background = element_blank(),
axis.ticks = element_blank())
prop_motivos_lojas <- proc_abertos_depara %>%
filter(Estrutura == 'LOJAS') %>%
group_by(LocalizacaoGeografica, categoria) %>%
summarise(qtde_processos = n()) %>%
ungroup() %>%
left_join(count_regiao, by = c('LocalizacaoGeografica')) %>%
left_join(prop_motivos %>% filter(Estrutura == 'LOJAS') %>% select(categoria, prop_motivo_est),
by = c('categoria')) %>%
left_join(percent_evasores_est_regiao %>% filter(Estrutura == 'LOJAS') %>% select(LocalizacaoGeografica, proporcao),
by = c('LocalizacaoGeografica')) %>%
mutate(prop_ref = prop_motivo_est * proporcao,
prop_motivo_regiao = qtde_processos / n,
prop_motivo_brasil = qtde_processos / n_proc_lojas_brasil,
delta_ref = prop_motivo_brasil - prop_ref,
std_error = sqrt(prop_motivo_regiao * (1 - prop_motivo_regiao) / n),
up_conf_inter95 = prop_motivo_regiao + qnorm(.975) * std_error,
low_conf_inter95 = prop_motivo_regiao - qnorm(.975) * std_error,
low_conf_inter95 = ifelse(low_conf_inter95 < 0, 0, low_conf_inter95)) %>%
complete(LocalizacaoGeografica, categoria, fill = list(delta_ref = 0)) %>%
arrange(delta_ref)
ggplot(prop_motivos_lojas %>%  filter(!is.na(LocalizacaoGeografica))) +
aes(y = fct_reorder(categoria, delta_ref, .fun = max),
x = fct_reorder(LocalizacaoGeografica, -delta_ref, min),
fill = delta_ref) +
geom_tile(color = 'gray80') +
geom_text(aes(label = paste0(sprintf("%+3.1f", 100 * delta_ref), 'pp')), color = 'gray20') +
scale_fill_gradient2(low = '#4d4d4d', high = '#5288db') +
scale_x_discrete(position = 'top') +
coord_equal() +
labs(x = '', y = '') +
guides(fill = 'none') +
theme(panel.background = element_blank(),
axis.ticks = element_blank())
sum(prop_motivos_lojas$prop_motivo_brasil)
sum(prop_motivos_lojas$prop_motivo_brasil, na.rm = T)
ggplot(prop_motivos_lojas %>%  filter(!is.na(LocalizacaoGeografica))) +
aes(y = fct_reorder(categoria, delta_ref, .fun = max),
x = fct_reorder(LocalizacaoGeografica, -delta_ref, min),
fill = prop_ref) +
geom_tile(color = 'gray80') +
geom_text(aes(label = paste0(sprintf("%+3.1f", 100 * delta_ref), 'pp')), color = 'gray20') +
scale_fill_gradient2(low = '#4d4d4d', high = '#5288db') +
scale_x_discrete(position = 'top') +
coord_equal() +
labs(x = '', y = '', title = 'Referência') +
guides(fill = 'none') +
theme(panel.background = element_blank(),
axis.ticks = element_blank())
ggplot(prop_motivos_lojas %>%  filter(!is.na(LocalizacaoGeografica))) +
aes(y = fct_reorder(categoria, delta_ref, .fun = max),
x = fct_reorder(LocalizacaoGeografica, -delta_ref, min),
fill = delta_ref) +
geom_tile(color = 'gray80') +
geom_text(aes(label = paste0(sprintf("%+3.1f", 100 * delta_ref), 'pp')), color = 'gray20') +
scale_fill_gradient2(low = '#4d4d4d', high = '#5288db') +
scale_x_discrete(position = 'top') +
coord_equal() +
labs(x = '', y = '', title = 'Variação em relação à referência') +
guides(fill = 'none') +
theme(panel.background = element_blank(),
axis.ticks = element_blank())
ggplot(prop_motivos_lojas %>%  filter(!is.na(LocalizacaoGeografica))) +
aes(y = fct_reorder(categoria, delta_ref, .fun = max),
x = fct_reorder(LocalizacaoGeografica, -delta_ref, min),
fill = prop_motivo_brasil) +
geom_tile(color = 'gray80') +
geom_text(aes(label = paste0(sprintf("%+3.1f", 100 * delta_ref), 'pp')), color = 'gray20') +
scale_fill_gradient2(low = '#4d4d4d', high = '#5288db') +
scale_x_discrete(position = 'top') +
coord_equal() +
labs(x = '', y = '', title = 'Proporção no Brasil') +
guides(fill = 'none') +
theme(panel.background = element_blank(),
axis.ticks = element_blank())
ggplot(prop_motivos_lojas %>%  filter(!is.na(LocalizacaoGeografica))) +
aes(y = fct_reorder(categoria, delta_ref, .fun = max),
x = fct_reorder(LocalizacaoGeografica, -delta_ref, min),
fill = prop_ref) +
geom_tile(color = 'gray80') +
geom_text(aes(label = paste0(sprintf("%+3.1f", 100 * delta_ref), 'pp')), color = 'gray20') +
scale_fill_gradient2(low = '#4d4d4d', high = '#5288db') +
scale_x_discrete(position = 'top') +
coord_equal() +
labs(x = '', y = '', title = 'Referência') +
guides(fill = 'none') +
theme(panel.background = element_blank(),
axis.ticks = element_blank())
ggplot(prop_motivos_lojas %>%  filter(!is.na(LocalizacaoGeografica))) +
aes(y = fct_reorder(categoria, delta_ref, .fun = max),
x = fct_reorder(LocalizacaoGeografica, -delta_ref, min),
fill = prop_motivo_brasil) +
geom_tile(color = 'gray80') +
geom_text(aes(label = paste0(sprintf("%+3.1f", 100 * delta_ref), 'pp')), color = 'gray20') +
scale_fill_gradient2(low = '#4d4d4d', high = '#5288db') +
scale_x_discrete(position = 'top') +
coord_equal() +
labs(x = '', y = '', title = 'Proporção no Brasil') +
guides(fill = 'none') +
theme(panel.background = element_blank(),
axis.ticks = element_blank())
ggplot(prop_motivos_lojas %>%  filter(!is.na(LocalizacaoGeografica))) +
aes(y = fct_reorder(categoria, delta_ref, .fun = max),
x = fct_reorder(LocalizacaoGeografica, -delta_ref, min),
fill = delta_ref) +
geom_tile(color = 'gray80') +
geom_text(aes(label = paste0(sprintf("%+3.1f", 100 * delta_ref), 'pp')), color = 'gray20') +
scale_fill_gradient2(low = '#4d4d4d', high = '#5288db') +
scale_x_discrete(position = 'top') +
coord_equal() +
labs(x = '', y = '', title = 'Variação em relação à referência') +
guides(fill = 'none') +
theme(panel.background = element_blank(),
axis.ticks = element_blank())
ggplot(prop_motivos_lojas %>%  filter(!is.na(LocalizacaoGeografica))) +
aes(y = fct_reorder(categoria, delta_ref, .fun = max),
x = fct_reorder(LocalizacaoGeografica, -delta_ref, min),
fill = prop_ref) +
geom_tile(color = 'gray80') +
geom_text(aes(label = paste0(sprintf("%+3.1f", 100 * prop_ref), 'pp')), color = 'gray20') +
scale_fill_gradient2(low = '#4d4d4d', high = '#5288db') +
scale_x_discrete(position = 'top') +
coord_equal() +
labs(x = '', y = '', title = 'Referência') +
guides(fill = 'none') +
theme(panel.background = element_blank(),
axis.ticks = element_blank())
prop_motivos_lojas <- proc_abertos_depara %>%
filter(Estrutura == 'LOJAS') %>%
group_by(LocalizacaoGeografica, categoria) %>%
summarise(qtde_processos = n()) %>%
ungroup() %>%
left_join(count_regiao, by = c('LocalizacaoGeografica')) %>%
left_join(prop_motivos %>% filter(Estrutura == 'LOJAS') %>% select(categoria, prop_motivo_est),
by = c('categoria')) %>%
left_join(percent_evasores_est_regiao %>% filter(Estrutura == 'LOJAS') %>% select(LocalizacaoGeografica, proporcao),
by = c('LocalizacaoGeografica')) %>%
mutate(prop_ref = prop_motivo_est * proporcao,
prop_motivo_regiao = qtde_processos / n,
prop_motivo_brasil = qtde_processos / n_proc_lojas_brasil,
delta_ref = prop_motivo_brasil - prop_ref,
std_error = sqrt(prop_motivo_regiao * (1 - prop_motivo_regiao) / n),
up_conf_inter95 = prop_motivo_regiao + qnorm(.975) * std_error,
low_conf_inter95 = prop_motivo_regiao - qnorm(.975) * std_error,
low_conf_inter95 = ifelse(low_conf_inter95 < 0, 0, low_conf_inter95)) %>%
complete(LocalizacaoGeografica, categoria, fill = list(delta_ref = 0, prop_ref = 0, prop_motivo_brasil = 0)) %>%
arrange(delta_ref)
ggplot(prop_motivos_lojas) +
aes(x = prop_motivo_regiao, y = LocalizacaoGeografica) +
geom_col(fill = 'gray80') +
geom_errorbar(aes(xmin = low_conf_inter95, xmax = up_conf_inter95),
width = 0.2,
color = '#4d4d4d') +
facet_wrap(~categoria, scales = 'free_x') +
scale_x_continuous(expand = expansion(mult = c(0, 0.1))) +
theme(panel.background = element_rect(fill = NA, color = 'gray70'),
axis.ticks.y = element_blank())
ggplot(prop_motivos_lojas %>%  filter(!is.na(LocalizacaoGeografica))) +
aes(y = fct_reorder(categoria, delta_ref, .fun = max),
x = fct_reorder(LocalizacaoGeografica, -delta_ref, min),
fill = prop_ref) +
geom_tile(color = 'gray80') +
geom_text(aes(label = paste0(sprintf("%+3.1f", 100 * prop_ref), 'pp')), color = 'gray20') +
scale_fill_gradient2(low = '#4d4d4d', high = '#5288db') +
scale_x_discrete(position = 'top') +
coord_equal() +
labs(x = '', y = '', title = 'Referência') +
guides(fill = 'none') +
theme(panel.background = element_blank(),
axis.ticks = element_blank())
ggplot(prop_motivos_lojas %>%  filter(!is.na(LocalizacaoGeografica))) +
aes(y = fct_reorder(categoria, delta_ref, .fun = max),
x = fct_reorder(LocalizacaoGeografica, -delta_ref, min),
fill = prop_motivo_brasil) +
geom_tile(color = 'gray80') +
geom_text(aes(label = paste0(sprintf("%+3.1f", 100 * prop_motivo_brasil), 'pp')), color = 'gray20') +
scale_fill_gradient2(low = '#4d4d4d', high = '#5288db') +
scale_x_discrete(position = 'top') +
coord_equal() +
labs(x = '', y = '', title = 'Proporção no Brasil') +
guides(fill = 'none') +
theme(panel.background = element_blank(),
axis.ticks = element_blank())
ggplot(prop_motivos_lojas %>%  filter(!is.na(LocalizacaoGeografica))) +
aes(y = fct_reorder(categoria, delta_ref, .fun = max),
x = fct_reorder(LocalizacaoGeografica, -delta_ref, min),
fill = delta_ref) +
geom_tile(color = 'gray80') +
geom_text(aes(label = paste0(sprintf("%+3.1f", 100 * delta_ref), 'pp')), color = 'gray20') +
scale_fill_gradient2(low = '#4d4d4d', high = '#5288db') +
scale_x_discrete(position = 'top') +
coord_equal() +
labs(x = '', y = '', title = 'Variação em relação à referência') +
guides(fill = 'none') +
theme(panel.background = element_blank(),
axis.ticks = element_blank())
ggplot(prop_motivos_lojas %>%  filter(!is.na(LocalizacaoGeografica))) +
aes(y = fct_reorder(categoria, delta_ref, .fun = max),
x = fct_reorder(LocalizacaoGeografica, -delta_ref, min),
fill = prop_ref) +
geom_tile(color = 'gray80') +
geom_text(aes(label = paste0(sprintf("%+3.1f", 100 * prop_ref), '%')), color = 'gray20') +
scale_fill_gradient2(low = '#4d4d4d', high = '#5288db') +
scale_x_discrete(position = 'top') +
coord_equal() +
labs(x = '', y = '', title = 'Referência') +
guides(fill = 'none') +
theme(panel.background = element_blank(),
axis.ticks = element_blank())
ggplot(prop_motivos_lojas %>%  filter(!is.na(LocalizacaoGeografica))) +
aes(y = fct_reorder(categoria, delta_ref, .fun = max),
x = fct_reorder(LocalizacaoGeografica, -delta_ref, min),
fill = prop_ref) +
geom_tile(color = 'gray80') +
geom_text(aes(label = paste0(sprintf("3.1f", 100 * prop_ref), '%')), color = 'gray20') +
scale_fill_gradient2(low = '#4d4d4d', high = '#5288db') +
scale_x_discrete(position = 'top') +
coord_equal() +
labs(x = '', y = '', title = 'Referência') +
guides(fill = 'none') +
theme(panel.background = element_blank(),
axis.ticks = element_blank())
ggplot(prop_motivos_lojas %>%  filter(!is.na(LocalizacaoGeografica))) +
aes(y = fct_reorder(categoria, delta_ref, .fun = max),
x = fct_reorder(LocalizacaoGeografica, -delta_ref, min),
fill = prop_ref) +
geom_tile(color = 'gray80') +
geom_text(aes(label = paste0(sprintf("%3.1f", 100 * prop_ref), '%')), color = 'gray20') +
scale_fill_gradient2(low = '#4d4d4d', high = '#5288db') +
scale_x_discrete(position = 'top') +
coord_equal() +
labs(x = '', y = '', title = 'Referência') +
guides(fill = 'none') +
theme(panel.background = element_blank(),
axis.ticks = element_blank())
ggplot(prop_motivos_lojas %>%  filter(!is.na(LocalizacaoGeografica))) +
aes(y = fct_reorder(categoria, delta_ref, .fun = max),
x = fct_reorder(LocalizacaoGeografica, -delta_ref, min),
fill = prop_ref) +
geom_tile(color = 'gray80') +
geom_text(aes(label = paste0(sprintf("%3.1f", 100 * prop_ref), '%')), color = 'gray20') +
scale_fill_gradient2(low = '#4d4d4d', high = '#5288db') +
scale_x_discrete(position = 'top') +
coord_equal() +
labs(x = '', y = '', title = 'Esperado') +
guides(fill = 'none') +
theme(panel.background = element_blank(),
axis.ticks = element_blank())
ggplot(prop_motivos_lojas %>%  filter(!is.na(LocalizacaoGeografica))) +
aes(y = fct_reorder(categoria, delta_ref, .fun = max),
x = fct_reorder(LocalizacaoGeografica, -delta_ref, min),
fill = prop_motivo_brasil) +
geom_tile(color = 'gray80') +
geom_text(aes(label = paste0(sprintf("%3.1f", 100 * prop_motivo_brasil), '%')), color = 'gray20') +
scale_fill_gradient2(low = '#4d4d4d', high = '#5288db') +
scale_x_discrete(position = 'top') +
coord_equal() +
labs(x = '', y = '', title = 'Encontrado') +
guides(fill = 'none') +
theme(panel.background = element_blank(),
axis.ticks = element_blank())
# Configurando ambiente ----
setwd("C:/Users/naruh/Google Drive/Projetos consultoria/Via Varejo/Projeto Turnover 2021/1. Tratamento bases")
rm(list = ls())
# Bibliotecas ----
library(tidyverse)
library(openxlsx)
library(eeptools)
library(rpart)
library(caret)
library(rpart.plot)
library(randomForest)
# Paleta de cores arvore
cores <- colorRampPalette(c('#8b8b8b', 'white', "#5288db"))
# Dados
load('trat_bases_pt2_cp3.RData')
data()
setwd("~/Tutoriais - R")
rm(list = ls())
library(tidyverse)
rh <- read.csv('dados/HR-Employee-Attrition.csv')
View(rh)
iris
LETTERS[1:4]
df1 <- data.frame(employee = LETTERS[1:4], area = c("Contabil", "Engenharia", "Engenharia", "RH"))
df2 <- data.frame(employee = c("B", "A", "D", "C"), contratacao = c(2004, 2015, 2020, 2002))
View(df1)
View(df2)
left_join(df1, df2, by = c("employee"))
c("azul_numera" = "#5288db")
df1 <- data.frame(employee = LETTERS[1:5], area = c("Contabil", "Engenharia", "Engenharia", "RH", "RH"))
left_join(df1, df2, by = c("employee" = "employee"))
inner_join(df1, df2, by = c("employee" = "employee"))
df1 <- data.frame(employee = c(LETTERS[1:5], "A"),
area = c("Contabil", "Engenharia", "Engenharia", "RH", "RH", "Engenharia"),
sobrenome = letters[1:6])
df2 <- data.frame(employee = c("B", "A", "D", "C"), contratacao = c(2004, 2015, 2020, 2002),
sobrenome = c("b", "e", "d", "c"))
df2 <- data.frame(employee = c("B", "A", "D", "C"), contratacao = c(2004, 2015, 2020, 2002),
surname = c("b", "e", "d", "c"))
inner_join(df1, df2, by = c("employee", "sobrenome" = "surname"))
df2 <- data.frame(employee = c("B", "A", "D", "C"), contratacao = c(2004, 2015, 2020, 2002),
surname = c("b", "f", "d", "c"))
inner_join(df1, df2, by = c("employee", "sobrenome" = "surname"))
left_join(df1, df2, by = c("employee", "sobrenome" = "surname"))
df2 <- data.frame(employee = c("B", "A", "D", "C", "A"), contratacao = c(2004, 2015, 2020, 2002, 1999),
surname = c("b", "a", "d", "c", "a"))
left_join(df1, df2, by = c("employee", "sobrenome" = "surname"))
inner_join(df1, df2, by = c("employee", "sobrenome" = "surname"))
nrow(df2)
df3 <- df2 %>%
distinct(employee, surname)
nrow(df3)
df2[duplicated(df2$employee)]
duplicated(df2$employee)
which(duplicated(df2$employee))
df2[ ,which(duplicated(df2$employee))]
df2[which(duplicated(df2$employee)), ]
View(df3)
df3 <- df2 %>%
distinct(employee, surname, .keep_all = T)
df_nao_retornado <-
anti_join(df2, df3, by = c("employee", "sobrenome" = "surname"))
df_nao_retornado <-
anti_join(df2, df3, by = c("employee", "surname"))
df_nao_retornado <-
anti_join(df2, df3, by = c("employee", "surname"))
df_nao_retornado <-
anti_join(df2, df3, by = c("employee", "surname", "contratacao"))
df_nao_retornado <-
anti_join(df3, df2, by = c("employee", "surname", "contratacao"))
anti_join(df3, df2, by = c("employee", "surname", "contratacao"))
anti_join(df2, df3, by = c("employee", "surname", "contratacao"))
anti_join(df2, df3, by = c("employee", "surname"))
